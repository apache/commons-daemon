<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements. See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License. You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!--
  This file is used by the maven-changes-plugin to generate the release notes.
  Useful ways of finding items to add to this file are:

  1. Add items when you fix a bug or add a feature (this makes the
  release process easy :-).

  2. Do a JIRA search for tickets closed since the previous release.

  3. Use the report generated by the maven-changelog-plugin to see all
  SVN commits. Set the project.properties' maven.changelog.range
  property to the number of days since the last release.


  The <action> type attribute can be add,update,fix,remove.
-->

<document>
  <properties>
    <title>Apache Commons Daemon Release Notes</title>
  </properties>
  <body>
    <release version="1.2.4" date="2021-01-21" description="Bug fix release">
      <action issue="DAEMON-424" type="fix" dev="markt" due-to="Bernhard Scholz">
        Procrun. Ensure that log messages written to stdout and stderr are not
        lost during start-up.
      </action>
      <action issue="DAEMON-425" type="fix" dev="markt">
        Procrun. Correct a regression introduced in 1.2.3. Enable the service to
        start if the Options value is not present in the registry.
      </action>
      <action issue="DAEMON-426" type="fix" dev="markt">
        jsvc. Don't fail if the CAP_DAC_READ_SEARCH capability is not available.
        Fall back to using argv[0] rather than /proc/self/exe to determine the
        path for the current binary.
      </action>
      <action issue="DAEMON-428" type="fix" dev="markt">
        Procrun. Remove some unnecessary code.
      </action>
    </release>
    <release version="1.2.3" date="2020-09-01" description="Bug fix release">
      <action issue="DAEMON-411" type="fix" dev="markt">
        Procrun. Correct multiple issues related to enabling a service to
        interact with the desktop. Provide a better error message if this option
        is used with an invalid user, install the service with the option
        enabled if requested and correctly save the setting if it is enabled in
        the GUI. 
      </action>
      <action issue="DAEMON-410" type="fix" dev="markt" due-to="Richard Morrell">
        jsvc. Update the list of paths searched for libjvm.so to include the
        path used by OpenJDK 11.
      </action>
      <action type="add" dev="markt">
        Procrun. Add additional debug logging for Java start mode.
      </action>
      <action type="fix" dev="markt" due-to="Ray Wang">
        jsvc. Remove incorrect definition 'supported_os' which defined in 
        psupport.m4 file to fix jsvc build error on s390, arm, aarch64, 
        mipsel and mips. 
      </action>
      <action type="add" dev="ggregory">
        Procrun. More debug logging in prunsrv.c and javajni.c.
      </action>
      <action issue="DAEMON-419" type="add" dev="ggregory" due-to="mads1980">
        jsvc. Update arguments.c to support Java 11 --enable-preview #18.
      </action>
      <action issue="DAEMON-412" type="add" dev="markt">
        jsvc and Procrun. Add support for Java native memory tracking.
      </action>
      <action issue="DAEMON-422" type="add" dev="markt">
        Procrun. Add a new command, print, that outputs the command to
        (re-)configure the service with the current settings. This is intended
        to be used to save settings such as before an upgrade. 
      </action>
    </release>
    <release version="1.2.2" date="2019-10-04" description="Bug fix release">
      <action issue="DAEMON-408" type="fix" dev="markt">
        Procrun. Correct a regression in the fix for DAEMON-401 that prevented
        the service from starting unless support for the universal C runtime had
        been installed.
      </action>
      <action type="update" dev="markt">
        Update Commons-Parent to version 49.
      </action>
      <action type="fix" dev="markt">
        Procrun. Fix compiler warnings for unreferenced formal parameters.
      </action>
      <action type="fix" dev="markt">
        Procrun. Switch code to use more secure versions of Windows API calls to
        resolve warnings reported by newer versions of Visual Studio.
      </action>
      <action type="fix" dev="markt">
        Correct the source assembly definitions to add README.md,
        CONTRIBUTING.md and HOWTO-RELEASE.txt, remove references to the deleted
        Ant build files and exclude the working directories of Windows binary
        builds.
      </action>
      <action type="add" dev="ggregory">
         More startup on Windows logging in javajni.c. #14. 
      </action>
    </release>
    <release version="1.2.1" date="2019-09-09" description="Bug fix release">
      <action issue="DAEMON-403" type="fix" dev="markt" due-to="Charles">
        jsvc. Correct debug log message that reports change in umask.
      </action>
      <action issue="DAEMON-401" type="fix" dev="markt" due-to="Norimasa Yamamoto">
        Procrun. Correct a regression in the previous fix for this issue that
        caused 32-bit services to crash on start-up.
      </action> 
      <action issue="DAEMON-407" type="fix" dev="markt">
        Procrun. Correct a regression in the fix for DAEMON-391 that caused the
        GUI to mix-up the WARN and INFO logging levels. 
      </action>
      <action issue="DAEMON-404" type="fix" dev="markt">
        Procrun. Expand the search for a valid Java runtime library to include
        the current JDK home defined in the Windows registry. Fully document the
        search algorithm used to find the Java runtime library.
      </action>
    </release>
    <release version="1.2.0" date="2019-07-02" description="Feature and bug fix release">
      <action type="fix" dev="markt" due-to="mturk" >
        Procrun. Add to OPT_LFLAGS rather than overwrite OPT_LFLAGS when setting
        /OPT:REF in the make file for Windows.
      </action>
      <action type="fix" dev="markt" due-to="mturk" >
        Procrun. Only set the global shutdown event if the event is created.
      </action>
      <action issue="DAEMON-379" type="fix" dev="sebb">
        Unable to build with Java 9 using ant; dropped Ant build files.
      </action>
      <action issue="DAEMON-384" type="fix" dev="ggregory" due-to="blassmegod">
        Procrun. prunsrv stopping with error due to hard-coded timeout.
      </action>
      <action issue="DAEMON-385" type="fix" dev="markt">
        Update config.guess and config.sub.
      </action>
      <action issue="DAEMON-388" type="fix" dev="markt">
        Jsvc. Set the sun.java.command system property when starting via jsvc so
        that tools like jconsole show something meaningful for the process name.
      </action>
      <action issue="DAEMON-391" type="fix" dev="markt" due-to="Thorsten SchÃ¶ning">
        Procrun. Correct the level name used in the GUI for WARN so that changes
        made via the GUI are recognised. Order the log levels in the drop-down
        from ERROR to DEBUG. 
      </action>
      <action issue="DAEMON-393" type="fix" dev="ggregory" due-to="Daniel Hofmann">
        Procrun. Correct reversed code comments for JRE and JDK locations in the
        registry.
      </action>
      <action issue="DAEMON-392" type="fix" dev="ggregory" due-to="Daniel Hofmann">
        Procrun. Undefined behavior in registry.c dwRegKey = dwRegKey++
      </action>
      <action issue="DAEMON-396" type="fix" dev="markt" due-to="Gerwin">
        Procrun. Fix a bug that meant a value provided for LibraryPath replaced
        the value of the PATH environment variable rather than prepended to it.
      </action>
      <action issue="DAEMON-396" type="fix" dev="markt" due-to="Gerwin">
        Procrun. Ensure that JAVA_HOME/bin is on the path when running in jvm
        mode so that additional DLLs, such as awt.dll, can be found if required.
      </action>
      <action issue="DAEMON-396" type="fix" dev="markt">
        Procrun. Ensure that the java.library.path environment variable is
        correctly configured when running on a JRE that depends on the Universal
        CRT.
      </action>
      <action type="add" dev="markt">
        Procrun. Log the error code returned if JVM creation fails to aid
        debugging.
      </action>
      <action type="add" dev="markt">
        Harden the Windows binaries against DLL hijacking in the directory where
        the binaries are located. 
      </action>
      <action issue="DAEMON-401" type="fix" dev="markt" due-to="Jonathan Gallimore">
        Procrun. Ensure that environment variables set via prunsrv are visible
        to native libraries that depend on the Universal CRT.
      </action> 
      <action type="add" dev="markt">
        Procrun. Add 'NT Authority\LocalService' and
        'NT Authority\NetworkService' as options to the Log On user interface.
      </action>
      <action type="update" dev="markt">
        Procrun. Change the default service user from LocalSystem to
        'NT Authority\LocalService'.
      </action>
      <action issue="DAEMON-402" type="fix" dev="markt" due-to="Iode Leroy">
        Procrun. Avoid a crash on shutdown if multiple WM_CLOSE messages are
        received.
      </action>
      <action issue="DAEMON-394" type="fix" dev="markt">
        Procrun. Ignore blank lines inserted into the Java Options and/or Java 9
        Options text areas. This prevents settings after the first blank line
        from being lost when saved to the registry.
      </action>
      <action issue="DAEMON-399" type="fix" dev="markt">
        Procrun. Remove the code that removed quotes from configured Java and
        Java 9 Options.
      </action>
      <action issue="DAEMON-398" type="fix" dev="markt">
        Procrun. Ensure that vfprintf is the first parameter passed when using
        JNI to create the JVM as a workaround for startup error messages not
        being visible on stdout or stderr.
      </action>
      <action issue="DAEMON-303" type="add" dev="markt">
        Procrun. Add an option to configure the service to use the 'Automatic
        (Delayed Start)' startup mode.
      </action>
      <action issue="DAEMON-329" type="add" dev="markt">
        Procrun. When running in jre mode, if the standard Java registry entries
        for JavaHome and RuntimeLib are not present, attempt to use the Procrun
        JavaHome key to find the runtime library.
      </action>
      <action issue="DAEMON-297" type="add" dev="markt">
        jsvc. Include the full path to the jsvc executable in the debug log.
      </action>
      <action issue="DAEMON-397" type="add" dev="markt" due-to="Petr Hadraba">
        jsvc. Improve search for libjli.dylib on MacOS when using custom built
        OpenJDK binaries.
      </action>
      <action type="fix" dev="markt" due-to="ggregory">
        Procun. Improve log messages for interactions with the Windows service.
      </action>
      <action type="fix" dev="markt" due-to="YunQiang Su">
        jsvc. Improve mips detection.
      </action>
    </release>
    <release version="1.1.0" date="2017-11-15" description="Feature and bug fix release">
      <action issue="DAEMON-368" type="add" dev="ggregory">
        Add DEBUG and ERROR logging to help diagnose problems when starting a Windows Service.
      </action>
      <action issue="DAEMON-371" type="update" dev="ggregory">
        Update the minimum Java requirement from version 5 to 6.
      </action>
      <action type="update" dev="markt">
        Increase minimum Java version to Java 5.
      </action>
      <action issue="DAEMON-347" type="update" dev="ggregory" due-to="Ganesh Raju">
        Add AArch64 support to src/native/unix/support/apsupport.m4
      </action>
      <action issue="DAEMON-346" type="fix" dev="markt">
        Compile the Windows binaries with the /DYNAMICBASE and /NXCOMPAT
        switches.
      </action>
      <action issue="DAEMON-333" type="fix" dev="markt">
        Remove calls to explicit garbage collection during daemon start and
        stop.
      </action>
      <action issue="DAEMON-343" type="fix" dev="markt">
        Update config.guess and config.sub to add support, amongst others, for
        the 64-bit PowerPC Little-Endian architecture. 
      </action>
      <action issue="DAEMON-332" type="fix" dev="markt">
        Ensure that the PID file on Windows, if used, is readable by other
        processes.
      </action>
      <action type="update" dev="markt">
        Update Commons-Parent to version 41.
      </action>
      <action issue="DAEMON-358" type="fix" dev="markt" due-to="Gustavo Romero">
        Update apsupport.m4 add support for 64-bit PowerPC architectures.
      </action>
      <action issue="DAEMON-282" type="fix" dev="markt">
        Suppress spurious &quot;The data area passed to a system call is too
        small&quot; error message in the log when Procrun fails to stop the
        service.
      </action>
      <action issue="DAEMON-370" type="update" dev="ggregory" due-to="Amey Jadiye">
      	Move attributions from @author in Javadocs to POM.
      </action>
      <action issue="DAEMON-373" type="fix" dev="markt">
        Enable jsvc to start when running on Java 9.
      </action>
      <action issue="DAEMON-324" type="fix" dev="markt">
        Fix a resource leak opening the JVM configuration file.
      </action>
      <action issue="DAEMON-339" type="fix" dev="markt" due-to="John Wehle">
        Improve the jsvc code that restarts the process if the JVM crashes so
        that if the JVM crashes after a signal has been received to shut down
        jsvc does not attempt to restart the JVM.
      </action>
      <action issue="DAEMON-318" type="fix" dev="markt" due-to="Markus Schneider">
        Ensure that the child process is started with the correct umask. 
      </action>
      <action issue="DAEMON-309" type="fix" dev="markt">
        Correct conflicting information for the behavior of Procrun when using
        jvm mode.
      </action>
      <action issue="DAEMON-372" type="fix" dev="markt" due-to="SÃ©rgio Ozaki">
        Ensure that, when using Procrun in java or exe mode, the service process
        waits for the stop process to complete before starting clean-up to avoid
        a crash in the stop process. 
      </action>
      <action issue="DAEMON-310" type="fix" dev="markt" due-to="John Wehle">
        Enable jsvc to find the jvm when running on AIX.
      </action>
      <action issue="DAEMON-302" type="fix" dev="markt">
        Ensure that Procrun treats JVM crashes as service failures so the
        recovery options will apply.
      </action>
      <action issue="DAEMON-312" type="fix" dev="markt">
        Ensure that the //MQ command closes the prunmgr process even if the 
        configuration dialog is open when the //MQ command is used.
      </action>
      <action issue="DAEMON-311" type="fix" dev="markt">
        When looking in the Windows registry for JRE and JDK installation
        locations, additionally check the registry keys used by IBM provided
        JREs and JDKs. Do this after checking the keys used by Oracle provided
        JREs and JDKs.
      </action>
      <action issue="DAEMON-376" type="fix" dev="markt">
        When looking in the Windows registry for JRE and JDK installation
        locations, additionally check the registry keys used by Oracle provided
        Java 9 and later JREs and JDKs. Do this after checking the keys used by
        Oracle provided Java 8 and earlier JREs and JDKs.
      </action>
      <action issue="DAEMON-374" type="fix" dev="markt" due-to="Rashmi Ranjan Mohanty">
        Add support for Java 9 command line arguments to jsvc.
      </action>
      <action issue="DAEMON-334" type="add" dev="markt" due-to="Brett Delle Grazie">
        Add a restarts options to jsvc to control the number of permitted
        restarts after a system crash.
      </action>
      <action type="remove" dev="markt">
        Remove support for building Procrun for the Itanium platform.
      </action>
      <action type="update" dev="markt">
        Make Windows XP the minimum support target platform.
      </action>
      <action type="add" dev="markt">
        Add support to Procrun for separate JVM options for use when running on
        Java 9 and above. 
      </action>
      <action issue="DAEMON-377" type="fix" dev="markt" due-to="Rustam Abdullaev">
        Fix race conditions in PID file handling in jsvc.
      </action> 
    </release>
  </body>
</document>
